# Winergy İş Takip Sistemi - Cron Job Örnekleri
# 
# Bu dosyayı crontab'a eklemek için:
#   crontab -e
# 
# Formatı anlamak için:
#   ┌───────────── dakika (0 - 59)
#   │ ┌───────────── saat (0 - 23)
#   │ │ ┌───────────── ayın günü (1 - 31)
#   │ │ │ ┌───────────── ay (1 - 12)
#   │ │ │ │ ┌───────────── haftanın günü (0 - 6) (Pazar=0)
#   │ │ │ │ │
#   * * * * * komut

###############################################################################
# 1. OTOMATIK YEDEKLEME
###############################################################################

# Her gün saat 02:00'da tam yedekleme (DB + Dosyalar)
0 2 * * * /var/www/html/Winergy_Is_Takip_Sistemi/scripts/backup.sh >> /var/log/winergy_backup.log 2>&1

# Sadece veritabanı yedeği - her 6 saatte bir
0 */6 * * * /var/www/html/Winergy_Is_Takip_Sistemi/scripts/backup.sh --db-only >> /var/log/winergy_db_backup.log 2>&1

# Haftada bir kez dosya yedeği (Pazar günleri saat 03:00)
0 3 * * 0 /var/www/html/Winergy_Is_Takip_Sistemi/scripts/backup.sh --files-only >> /var/log/winergy_files_backup.log 2>&1

###############################################################################
# 2. LOG TEMİZLEME
###############################################################################

# Her ayın ilk günü eski logları temizle (30 günden eski)
0 4 1 * * php /var/www/html/Winergy_Is_Takip_Sistemi/scripts/cleanup_logs.php >> /var/log/winergy_cleanup.log 2>&1

# Her hafta log rotation kontrolü (Pazartesi sabahı)
0 1 * * 1 php /var/www/html/Winergy_Is_Takip_Sistemi/scripts/rotate_logs.php >> /var/log/winergy_rotate.log 2>&1

###############################################################################
# 3. VERİTABANI OPTİMİZASYONU
###############################################################################

# Haftalık veritabanı optimizasyonu (Pazar sabahı 04:00)
0 4 * * 0 mysql -u root -p'SIFRENIZ' -e "OPTIMIZE TABLE winergy_is_takip.jobs, winergy_is_takip.customers, winergy_is_takip.users;" >> /var/log/winergy_optimize.log 2>&1

###############################################################################
# 4. DISK ALANI KONTROLÜ
###############################################################################

# Her gün disk alanını kontrol et ve %90 doluysa e-posta gönder
0 8 * * * df -h | grep -vE '^Filesystem|tmpfs|cdrom' | awk '{ print $5 " " $1 }' | while read output; do echo $output; usep=$(echo $output | awk '{ print $1}' | cut -d'%' -f1); partition=$(echo $output | awk '{ print $2 }'); if [ $usep -ge 90 ]; then echo "Disk alanı %$usep doldu: $partition" | mail -s "Disk Alanı Uyarısı" admin@winergytech.com; fi; done

###############################################################################
# 5. OTOMATIK GÜNCELLEME KONTROLÜ (GitHub'dan)
###############################################################################

# Her gün saat 05:00'te güncellemeleri kontrol et
# 0 5 * * * cd /var/www/html/Winergy_Is_Takip_Sistemi && git fetch origin && git status >> /var/log/winergy_git_check.log 2>&1

###############################################################################
# 6. SAĞLIK KONTROLÜ (HEALTH CHECK)
###############################################################################

# Her 15 dakikada bir sistemin çalıştığını kontrol et
*/15 * * * * curl -s https://yourdomain.com/health_check.php > /dev/null || echo "Site down!" | mail -s "Winergy Site Çalışmıyor!" admin@winergytech.com

###############################################################################
# 7. RAPORLAR
###############################################################################

# Her Pazartesi sabahı 08:00'de haftalık rapor oluştur
0 8 * * 1 php /var/www/html/Winergy_Is_Takip_Sistemi/scripts/weekly_report.php | mail -s "Haftalık Rapor" admin@winergytech.com

# Ayın ilk günü aylık rapor gönder
0 9 1 * * php /var/www/html/Winergy_Is_Takip_Sistemi/scripts/monthly_report.php | mail -s "Aylık Rapor" admin@winergytech.com

###############################################################################
# 8. GÜVENLİK
###############################################################################

# Her gün şüpheli login denemelerini kontrol et
0 23 * * * grep "Failed login" /var/www/html/Winergy_Is_Takip_Sistemi/logs/activity_*.log | tail -50 | mail -s "Başarısız Login Denemeleri" admin@winergytech.com

###############################################################################
# WINDOWS (Task Scheduler) İÇİN ÖRNEKLERİ
###############################################################################

# Windows'ta Task Scheduler kullanarak backup almak için:
# 1. Task Scheduler'ı açın
# 2. "Create Basic Task" seçin
# 3. Trigger: Daily, 02:00 AM
# 4. Action: Start a program
# 5. Program/script: C:\Program Files\Git\bin\bash.exe
# 6. Add arguments: C:/xampp/htdocs/Winergy_Is_Takip_Sistemi/scripts/backup.sh

###############################################################################
# ÖNEMLİ NOTLAR
###############################################################################

# 1. Script dosyalarına çalıştırma izni verin:
#    chmod +x /var/www/html/Winergy_Is_Takip_Sistemi/scripts/*.sh

# 2. Log dosyalarının yazılabilir olduğundan emin olun:
#    touch /var/log/winergy_backup.log
#    chmod 644 /var/log/winergy_backup.log

# 3. E-posta bildirimleri için mail komutunun kurulu olduğundan emin olun:
#    sudo apt-get install mailutils  # Debian/Ubuntu
#    sudo yum install mailx           # CentOS/RHEL

# 4. Cron job'ların çalışıp çalışmadığını kontrol edin:
#    grep CRON /var/log/syslog        # Debian/Ubuntu
#    grep CRON /var/log/cron          # CentOS/RHEL

# 5. Manuel test için:
#    /var/www/html/Winergy_Is_Takip_Sistemi/scripts/backup.sh

###############################################################################
# KURULUM
###############################################################################

# Bu dosyayı crontab'a eklemek için:
# 1. Dosyayı düzenleyin ve yolları kendinize göre ayarlayın
# 2. Şifreleri ve e-posta adreslerini güncelleyin
# 3. crontab -e komutuyla açın
# 4. Bu dosyanın içeriğini yapıştırın veya:
#    crontab /var/www/html/Winergy_Is_Takip_Sistemi/scripts/crontab.example

# Mevcut cron job'ları görmek için:
#    crontab -l
